(()=>{"use strict";class t{constructor(t,e,n,r){this.templateElement=document.getElementById(t),this.hostElement=document.getElementById(e);const s=document.importNode(this.templateElement.content,!0);this.element=s.firstElementChild,this.element.id=r,this.attach(n)}attach(t){this.hostElement.insertAdjacentElement(t?"afterbegin":"beforeend",this.element)}}const e={};function n(t,n){var r,s;e[t.constructor.name]=Object.assign(Object.assign({},e[t.constructor.name]),{[n]:[...null!==(s=null===(r=e[t.constructor.name])||void 0===r?void 0:r[n])&&void 0!==s?s:[],"required"]})}var r,s,o=function(t,e,n,r){var s,o=arguments.length,i=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(i=(o<3?s(i):o>3?s(e,n,i):s(e,n))||i);return o>3&&i&&Object.defineProperty(e,n,i),i};!function(t){t.Active="active",t.Finished="finished"}(r||(r={}));class i{constructor(t,e,n,r,s){this.id=t,this.title=e,this.description=n,this.manday=r,this.status=s}}o([n,(s={minLength:2},function(t,n){var r,o,i,a;e[t.constructor.name]=Object.assign(Object.assign({},e[t.constructor.name]),{[n]:[...null!==(o=null===(r=e[t.constructor.name])||void 0===r?void 0:r[n])&&void 0!==o?o:[],`length:${null!==(i=s.minLength)&&void 0!==i?i:0}:${null!==(a=s.maxLength)&&void 0!==a?a:0}`]})})],i.prototype,"title",void 0),o([n],i.prototype,"description",void 0),o([function(t,n){var r,s;e[t.constructor.name]=Object.assign(Object.assign({},e[t.constructor.name]),{[n]:[...null!==(s=null===(r=e[t.constructor.name])||void 0===r?void 0:r[n])&&void 0!==s?s:[],"positive"]})}],i.prototype,"manday",void 0);class a{constructor(){this.listeners=[]}addListner(t){this.listeners.push(t)}}class c extends a{constructor(){super(),this.projects=[]}static getInstance(){return this.instance||(this.instance=new c),this.instance}addListner(t){this.listeners.push(t)}addProject(t,e,n,r){const s=new i(Math.random().toString(),t,e,n,r);this.projects.push(s),this.updateListeners()}moveProject(t,e){const n=this.projects.find((e=>e.id===t));n&&n.status!==e&&(n.status=e,this.updateListeners())}updateListeners(){this.listeners.forEach((t=>t(this.projects.slice())))}}const l=c.getInstance();function d(t,e,n){const r=n.value;return{configurable:!0,get(){return r.bind(this)}}}class u extends t{constructor(){super("project-input","app",!0,"user-input"),this.titleInputElement=this.element.querySelector("#title"),this.descriptionInputElement=this.element.querySelector("#description"),this.mandayInputElement=this.element.querySelector("#manday"),this.configure()}configure(){this.element.addEventListener("submit",this.submitHandler)}renderContent(){}gatherUserInput(){const t=this.titleInputElement.value,n=this.descriptionInputElement.value,s=this.mandayInputElement.value;return function(t){const n=e[t.constructor.name];if(!n)return!0;let r=!0;for(const e in n)for(const s of n[e]){switch(console.log(`prop: ${e}`),console.log(`obj[prop]: ${t[e]}`),console.log(`validator: ${s}`),s){case"required":r=r&&0!==t[e].toString().trim().length;break;case"positive":r=r&&t[e]>0}if(s.startsWith("length")){const n=s.split(":"),o=n[1],i=n[2],a=t[e].toString();o||(r=r&&a.length>=+o),i||(r=r&&a.length<=+i)}}return r}(new i(Math.random().toString(),t,n,+s,r.Active))?[t,n,+s]:void alert("入力値が正しくありません。再度試してください。")}clearInputs(){this.titleInputElement.value="",this.descriptionInputElement.value="",this.mandayInputElement.value=""}submitHandler(t){t.preventDefault();const e=this.gatherUserInput();if(Array.isArray(e)){const[t,n,s]=e;l.addProject(t,n,s,r.Active),this.clearInputs()}}}!function(t,e,n,r){var s,o=arguments.length,i=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(i=(o<3?s(i):o>3?s(e,n,i):s(e,n))||i);o>3&&i&&Object.defineProperty(e,n,i)}([d],u.prototype,"submitHandler",null);var h=function(t,e,n,r){var s,o=arguments.length,i=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(i=(o<3?s(i):o>3?s(e,n,i):s(e,n))||i);return o>3&&i&&Object.defineProperty(e,n,i),i};class p extends t{get manday(){return this.project.manday<20?this.project.manday+"人日":(this.project.manday/20).toString()+"人月"}constructor(t,e){super("single-project",t,!1,e.id),this.project=e,this.configure(),this.renderContent()}dragStarthandler(t){t.dataTransfer.setData("text/plain",this.project.id),t.dataTransfer.effectAllowed="move"}dragEndHandler(t){console.log("drag end:"+this.project.id)}configure(){this.element.draggable=!0,this.element.addEventListener("dragstart",this.dragStarthandler),this.element.addEventListener("dragend",this.dragEndHandler)}renderContent(){this.element.querySelector("h2").textContent=this.project.title,this.element.querySelector("h3").textContent=this.manday,this.element.querySelector("p").textContent=this.project.description}}h([d],p.prototype,"dragStarthandler",null),h([d],p.prototype,"dragEndHandler",null);var m=function(t,e,n,r){var s,o=arguments.length,i=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(i=(o<3?s(i):o>3?s(e,n,i):s(e,n))||i);return o>3&&i&&Object.defineProperty(e,n,i),i};class g extends t{constructor(t){super("project-list","app",!1,`${t}-projects`),this.type=t,this.assignedProjects=[],this.configure(),this.renderContent()}dragOverhandler(t){t.dataTransfer&&"text/plain"===t.dataTransfer.types[0]&&(t.preventDefault(),this.element.querySelector("ul").classList.add("droppable"))}dropHandler(t){const e=t.dataTransfer.getData("text/plain");l.moveProject(e,this.type)}dragLeaveHandler(t){this.element.querySelector("ul").classList.remove("droppable")}configure(){this.element.addEventListener("dragover",this.dragOverhandler),this.element.addEventListener("drop",this.dropHandler),this.element.addEventListener("dragleave",this.dragLeaveHandler),l.addListner((t=>{const e=t.filter((t=>t.status===this.type));this.assignedProjects=e,this.renderProjects()}))}renderContent(){const t=`${this.type}-projects-list`;this.element.querySelector("ul").id=t,this.element.querySelector("h2").textContent=this.type===r.Active?"実行中プロジェクト":"完了プロジェクト"}renderProjects(){const t=document.getElementById(`${this.type}-projects-list`);t.innerHTML="";for(const e of this.assignedProjects)console.log(e),new p(t.id,e)}}m([d],g.prototype,"dragOverhandler",null),m([d],g.prototype,"dropHandler",null),m([d],g.prototype,"dragLeaveHandler",null),new u,new g(r.Active),new g(r.Finished),console.log("testest")})();